<div >

<%= form_for([@trip,@participant], local: true) do |form| %>
  <% if participant.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(participant.errors.count, "error") %> prohibited this participant from being saved:</h2>

      <ul>
        <% participant.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>
 
  <div class="field">
    <%= form.label "عـدد الأشـخاص" %>
    <select id="participant-number" name="participant_number" onChange="participantNumber()">
      <option value="1" id="one-participant" selected="true">1</option>
      <option value="2" >2</option>
      <option value="3">3</option>
    </select>
  </div>
  <div id="sibling-form">
  </div>
<div>

  <div class="field">
    <%= form.label "الأسـم الأول" %>
    <%= form.text_field :first_name , :name => "participant[first_name][]"%>
  </div>

  <div class="field">
    <%= form.label "الأسـم الأخـير" %>
    <%= form.text_field :last_name , :name => "participant[last_name][]"%>
  </div>

  <div class="field">
    <%= form.label "الأمـيـل" %>
    <%= form.text_field :email , :name => "participant[email][]"%>
  </div>

  <div class="field">
    <%= form.label "الـجنـس" %>
    <%= form.text_field :gender , :name => "participant[gender][]"%>
  </div>

</div>

  
   <div class="field">
    <%= form.label "المجموع" %>
    <h4 id="total"><%= @trip.price %></h4>
  <div>
  


  <div class="actions">
    <%= form.submit %>
  </div>
<!-- JS -->
 <script>
    

    let mainParticipantNumber = 1;
    let participantNumber = function(e){
      // select the option 
      const getNumber = document.getElementById('participant-number').selectedOptions[0].text;
      document.getElementById('participant-number').selectedOptions[0].setAttribute('selected','true')
      console.log(Number(getNumber) )
      // select the element of total
      const updateTotal = document.getElementById('total');
      // update the element of total as UI
      updateTotal.innerHTML = <%= @trip.price %> * getNumber


      // select the form 
      const form = document.getElementById('sibling-form');
      
      //make a loop as number of participant - 1
      // by default the participant is 1

      
      if (mainParticipantNumber <  Number(getNumber) ){
          //add the last child in the form depends on the option number 
           for(let num = mainParticipantNumber ; num < Number(getNumber) ; num++){
          form.innerHTML += `
          <div>
          <div class="field">
          <%= form.label "الأسـم الأول" %>
          <%= form.text_field :first_name , :name => "participant[first_name][]"%>
          </div>

          <div class="field">
          <%= form.label "الأسـم الأخـير" %>
          <%= form.text_field :last_name , :name => "participant[last_name][]"%>
          </div>

          <div class="field">
          <%= form.label "الأمـيـل" %>
          <%= form.text_field :email , :name => "participant[email][]"%>
          </div>

          <div class="field">
          <%= form.label "الـجنـس" %>
          <%= form.text_field :gender , :name => "participant[gender][]"%>
          </div>
          </div>`
          }
          mainParticipantNumber = Number(getNumber) 
      }
      else {
          //remove the last child in the form depends on the option number 
          for(let num = mainParticipantNumber ; num > Number(getNumber) ; num--){
            form.removeChild(form.lastChild);
            form.removeChild(form.lastChild);
            console.log(num)
          }
          mainParticipantNumber = Number(getNumber)
      }



    }


   </script>

<% end %>

</div>



